<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>smoothr: spatial feature smoothing in R • smoothr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="smoothr: spatial feature smoothing in R">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">smoothr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/smoothr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mstrimas/smoothr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>smoothr: spatial feature smoothing in R</h1>
            
      
      <small>Source: <a href="https://github.com/mstrimas/smoothr/blob/master/vignettes/smoothr.Rmd"><code>vignettes/smoothr.Rmd</code></a></small>

    </div>

    
    
<div class="contents">
<p>This package arose out of an desire for an R tool for smoothing polygons, especially those coming from raster-to-polygon conversion, to make lines and polygons have more natural, aesthetically pleasing curves. ArcGIS has the <a href="http://desktop.arcgis.com/en/arcmap/10.3/tools/cartography-toolbox/smooth-polygon.htm">Smooth Polygon</a> tool that works nicely; however, I was unable to find an R equivalent.</p>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raster)
<span class="kw">library</span>(sf)
<span class="kw">library</span>(units)
<span class="kw">library</span>(smoothr)</code></pre></div>
</div>
<div id="example-data" class="section level2">
<h2 class="hasAnchor">
<a href="#example-data" class="anchor"></a>Example data</h2>
<p>This package comes with two simple spatial datasets in <code>sf</code> format to test the smoothing algorithms on. <code>jagged_polygons</code> contains 9 polygons with sharp corners begging to be smoothed out:</p>
<p><img src="smoothr_files/figure-html/jagged-polygons-1.png" width="672"></p>
<p>Notice that these polygons have a range of complexities, some have holes, and some are mutlipart polygons. I’ve added a few flags to distinguish between the different types.</p>
<pre><code>#&gt; Simple feature collection with 9 features and 4 fields
#&gt; geometry type:  GEOMETRY
#&gt; dimension:      XY
#&gt; bbox:           xmin: 0 ymin: 0 xmax: 1 ymax: 1
#&gt; epsg (SRID):    4326
#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs
#&gt;   id    type  hole multipart                       geometry
#&gt; 1  1 polygon FALSE     FALSE POLYGON ((0.4444444 0.55555...
#&gt; 2  2 polygon FALSE     FALSE POLYGON ((0.5555556 0.44444...
#&gt; 3  3 polygon FALSE     FALSE POLYGON ((0.5555556 0.11111...
#&gt; 4  4 polygon FALSE     FALSE POLYGON ((0.7854351 0.47743...
#&gt; 5  5 polygon  TRUE     FALSE POLYGON ((0.5555556 0.22222...
#&gt; 6  6 polygon  TRUE     FALSE POLYGON ((0.5555556 0.11111...
#&gt; 7  7 polygon FALSE      TRUE MULTIPOLYGON (((0.6666667 0...
#&gt; 8  8 polygon FALSE      TRUE MULTIPOLYGON (((0 0.1111111...
#&gt; 9  9 polygon  TRUE      TRUE MULTIPOLYGON (((0.5555556 0...</code></pre>
<p><code>jagged_lines</code> contains 9 polylines with disgustingly crooked edges.</p>
<p><img src="smoothr_files/figure-html/jagged-lines-1.png" width="672"></p>
<p>Again, there’s a range of complexities, some lines form closed loops, and some are multipart.</p>
<pre><code>#&gt; Simple feature collection with 9 features and 4 fields
#&gt; geometry type:  GEOMETRY
#&gt; dimension:      XY
#&gt; bbox:           xmin: 0 ymin: 0 xmax: 1 ymax: 1
#&gt; epsg (SRID):    4326
#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs
#&gt;   id type closed multipart                       geometry
#&gt; 1  1 line  FALSE     FALSE LINESTRING (0 0, 0.25 0.003...
#&gt; 2  2 line  FALSE     FALSE LINESTRING (0 0.5, 0.2 0.97...
#&gt; 3  3 line  FALSE     FALSE LINESTRING (0 0.5, 0.05 0.9...
#&gt; 4  4 line   TRUE     FALSE LINESTRING (0.4444444 0.555...
#&gt; 5  5 line   TRUE     FALSE LINESTRING (0.5555556 0.444...
#&gt; 6  6 line   TRUE     FALSE LINESTRING (0.5555556 0.111...
#&gt; 7  7 line  FALSE      TRUE MULTILINESTRING ((0 0, 0.25...
#&gt; 8  8 line  FALSE      TRUE MULTILINESTRING ((0 0, 0.25...
#&gt; 9  9 line   TRUE      TRUE MULTILINESTRING ((0.5555556...</code></pre>
<p>The final dataset that comes with this package, <code>jagged_raster</code>, is a simulated occurrence probability for a species, consisting of a spatially auto-correlated raster layer with values between 0 and 1. It is a 25x25 grid of 100 square kilometer cells in a North American centered Albers Equal Area projection. This raster can be used to experiment with smoothing polygons generated from rasters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r &lt;-<span class="st"> </span>jagged_raster
<span class="co"># plot</span>
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/rasterToPolygons">rasterToPolygons</a></span>(r), <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="ot">NA</span>) <span class="co"># set up plot extent</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(r, <span class="dt">col =</span> <span class="kw">heat.colors</span>(<span class="dv">100</span>), <span class="dt">legend =</span> <span class="ot">FALSE</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">box =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="smoothr_files/figure-html/guass-field-1.png" width="672"></p>
</div>
<div id="smoothing-methods" class="section level2">
<h2 class="hasAnchor">
<a href="#smoothing-methods" class="anchor"></a>Smoothing methods</h2>
<p>Thus far, I’ve implemented three smoothing methods: Chaikin’s corner cutting algorithm, Gaussian kernel smoothing, and spline interpolation. All are accessed with the <code><a href="../reference/smooth.html">smooth()</a></code> function, and all methods work on spatial lines and polygons in <code>sf</code> and <code>sp</code> format.</p>
<div id="chaikins-corner-cutting-algorithm" class="section level3">
<h3 class="hasAnchor">
<a href="#chaikins-corner-cutting-algorithm" class="anchor"></a>Chaikin’s corner cutting algorithm</h3>
<p>Chaikin’s corner cutting algorithm smooths by iteratively replacing every point by two new points: one 1/4 of the way to the next point and one 1/4 of the way to the previous point. Consult the references below for details, but essentially the idea is to iteratively cut off corners until the curve is smooth. I’ve found this method to produce fairly natural looking smooth curves, although they’re a little more “boxy” than I’d like, and the algorithm has the benefit of only requiring a single parameter: the number of smoothing iterations.</p>
<p>This method can be applied with <code><a href="../reference/smooth.html">smooth(x, method = "chaikin")</a></code>. Here’s what this looks like for the polygons:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p_smooth_chaikin &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smooth.html">smooth</a></span>(jagged_polygons, <span class="dt">method =</span> <span class="st">"chaikin"</span>)
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>))
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">nrow</a></span>(jagged_polygons)) {
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(jagged_polygons[i, ]), <span class="dt">col =</span> <span class="st">"grey40"</span>, <span class="dt">border =</span> <span class="ot">NA</span>)
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(p_smooth_chaikin[i, ]), <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="st">"#E41A1C"</span>, 
       <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)
}</code></pre></div>
<p><img src="smoothr_files/figure-html/chaikin-polygons-1.png" width="672"></p>
<p>And for the lines:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l_smooth_chaikin &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smooth.html">smooth</a></span>(jagged_lines, <span class="dt">method =</span> <span class="st">"chaikin"</span>)
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>))
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">nrow</a></span>(jagged_lines)) {
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(jagged_lines[i, ]), <span class="dt">col =</span> <span class="st">"grey20"</span>, <span class="dt">lwd =</span> <span class="dv">3</span>)
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(l_smooth_chaikin[i, ]), <span class="dt">col =</span> <span class="st">"#E41A1C"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)
}</code></pre></div>
<p><img src="smoothr_files/figure-html/chaikin-lines-1.png" width="672"></p>
</div>
<div id="kernel-smoothing" class="section level3">
<h3 class="hasAnchor">
<a href="#kernel-smoothing" class="anchor"></a>Kernel smoothing</h3>
<p>This method applies Gaussian kernel regression to the x and y coordinates independently using the built-in <code>ksmooth()</code> function. Prior to smoothing, additional vertices are added via densification with <code><a href="../reference/smooth_densify.html">smooth_densify()</a></code>. Like the corner cutting algorithm, this method results in a curve that does not pass through the vertices of the original curve. Kernel smoothing produces natural looking curves with a greater degree of generalization than the corner cutting algorithm. <code><a href="../reference/smooth_ksmooth.html">smooth_ksmooth()</a></code> has parameters specifying the number of points in the resulting feature (either the number of sub-segments to split each line segment into or the maximum distance between points) and the bandwidth of the Gaussian kernel. Choosing a suitable bandwidth is critical for correctly smoothing features using this algorithm and typically users will want to explore a range of bandwidth to find a value that works for their particular scenario.</p>
<p>This method can be applied with <code><a href="../reference/smooth.html">smooth(x, method = "ksmooth")</a></code>. Here’s what this looks like for the polygons:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p_smooth_ksmooth &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smooth.html">smooth</a></span>(jagged_polygons, <span class="dt">method =</span> <span class="st">"ksmooth"</span>)
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>))
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">nrow</a></span>(jagged_polygons)) {
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(jagged_polygons[i, ]), <span class="dt">col =</span> <span class="st">"grey40"</span>, <span class="dt">border =</span> <span class="ot">NA</span>)
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(p_smooth_ksmooth[i, ]), <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="st">"#E41A1C"</span>, 
       <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)
}</code></pre></div>
<p><img src="smoothr_files/figure-html/smooth-polygons-1.png" width="672"></p>
<p>And for the lines:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l_smooth_ksmooth &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smooth.html">smooth</a></span>(jagged_lines, <span class="dt">method =</span> <span class="st">"ksmooth"</span>)
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>))
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">nrow</a></span>(jagged_lines)) {
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(jagged_lines[i, ]), <span class="dt">col =</span> <span class="st">"grey20"</span>, <span class="dt">lwd =</span> <span class="dv">3</span>)
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(l_smooth_ksmooth[i, ]), <span class="dt">col =</span> <span class="st">"#E41A1C"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)
}</code></pre></div>
<p><img src="smoothr_files/figure-html/ksmooth-lines-1.png" width="672"></p>
</div>
<div id="spline-interpolation" class="section level3">
<h3 class="hasAnchor">
<a href="#spline-interpolation" class="anchor"></a>Spline interpolation</h3>
<p>This method applies a spline interpolation to the x and y coordinates independently using the built-in <code>spline()</code> function. For polygons (and closed lines), <code>method = "periodic"</code> is used to avoid getting a kink at the start/end of the curve defining the boundary. Unlike the corner cutting algorithm, this method results in a curve that passes through the vertices of the original curve, which may be a desirable feature. Unfortunately, this results in an unnaturally wiggly curve. Spline interpolation requires a parameter specifying the number of points to interpolate at, which can either be an absolute number or a relative increase in the number of vertices.</p>
<p>This method can be applied with <code><a href="../reference/smooth.html">smooth(x, method = "spline")</a></code>. Here’s what this looks like for the polygons:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p_smooth_spline &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smooth.html">smooth</a></span>(jagged_polygons, <span class="dt">method =</span> <span class="st">"spline"</span>)
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>))
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">nrow</a></span>(jagged_polygons)) {
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(p_smooth_spline[i, ]), <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="ot">NA</span>)
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(jagged_polygons[i, ]), <span class="dt">col =</span> <span class="st">"grey40"</span>, <span class="dt">border =</span> <span class="ot">NA</span>, 
       <span class="dt">add =</span> <span class="ot">TRUE</span>)
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(p_smooth_spline[i, ]), <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="st">"#E41A1C"</span>, 
       <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)
}</code></pre></div>
<p><img src="smoothr_files/figure-html/spline-polygons-1.png" width="672"></p>
<p>And for the lines:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l_smooth_spline &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smooth.html">smooth</a></span>(jagged_lines, <span class="dt">method =</span> <span class="st">"spline"</span>)
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>))
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">nrow</a></span>(jagged_lines)) {
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(l_smooth_spline[i, ]), <span class="dt">col =</span> <span class="ot">NA</span>)
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(jagged_lines[i, ]), <span class="dt">col =</span> <span class="st">"grey20"</span>, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(l_smooth_spline[i, ]), <span class="dt">col =</span> <span class="st">"#E41A1C"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)
}</code></pre></div>
<p><img src="smoothr_files/figure-html/spline-lines-1.png" width="672"></p>
</div>
</div>
<div id="other-goodies" class="section level2">
<h2 class="hasAnchor">
<a href="#other-goodies" class="anchor"></a>Other goodies</h2>
<p><code>smoothr</code> contains some additional tools that aren’t strictly for smoothing, but can help clean up polygons and lines and make them appear more aesthetically pleasing. I’ll outline these miscellaneous tools below.</p>
<div id="densification" class="section level3">
<h3 class="hasAnchor">
<a href="#densification" class="anchor"></a>Densification</h3>
<p>Densification is the process of adding additional points to the line segments defining points or polygons. Each line segment is split into multiple sub-segments of equal length, and the original vertices are always included in the densified feature. Note that the densification algorithm treats all vertices as Euclidean points, i.e. new points will not fall on a great circle between existing vertices, rather they’ll be along a straight line.</p>
<p>Use <code><a href="../reference/smooth.html">smooth(method = "densify")</a></code>, or it’s alias <code><a href="../reference/densify.html">densify()</a></code> to perform densification. The degree of densification can either be specified as the number of sub-segments each line segment is split into (<code>n</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l &lt;-<span class="st"> </span>jagged_lines<span class="op">$</span>geometry[[<span class="dv">2</span>]]
<span class="co"># split every segment into 2</span>
l_dense &lt;-<span class="st"> </span><span class="kw"><a href="../reference/densify.html">densify</a></span>(l, <span class="dt">n =</span> <span class="dv">2</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(l, <span class="dt">lwd =</span> <span class="dv">5</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(l_dense, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(l_dense <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_cast">st_cast</a></span>(<span class="st">"MULTIPOINT"</span>), <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="smoothr_files/figure-html/densify-n-1.png" width="672"></p>
<p>Or the maximum Euclidean distance between vertices (<code>max_distance</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l &lt;-<span class="st"> </span>jagged_lines<span class="op">$</span>geometry[[<span class="dv">2</span>]]
<span class="co"># split every segment into 2</span>
l_dense &lt;-<span class="st"> </span><span class="kw"><a href="../reference/densify.html">densify</a></span>(l, <span class="dt">max_distance =</span> <span class="fl">0.1</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(l, <span class="dt">lwd =</span> <span class="dv">5</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(l_dense, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(l_dense <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_cast">st_cast</a></span>(<span class="st">"MULTIPOINT"</span>), <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="smoothr_files/figure-html/densify-md-1.png" width="672"></p>
</div>
<div id="drop-crumbs" class="section level3">
<h3 class="hasAnchor">
<a href="#drop-crumbs" class="anchor"></a>Drop crumbs</h3>
<p><code><a href="../reference/drop_crumbs.html">drop_crumbs()</a></code> removes small lines or polygons based on a length or area threshold. For multipart features, this function dives into the individual component features and applies the threshold. The threshold can either be provided as a number, assumed to be in the units of the coordinates reference system (meters for unprojected coordinates), or as a <code>units</code> object. This latter approach provides more flexibility because a threshold can be given in any type of units and it will be converted to the correct units automatically.</p>
<p>For example, to remove polygons less than 200 square kilometers:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span>jagged_polygons<span class="op">$</span>geometry[<span class="dv">7</span>]
area_thresh &lt;-<span class="st"> </span>units<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/units/topics/set_units">set_units</a></span>(<span class="dv">200</span>, km<span class="op">^</span><span class="dv">2</span>)
p_dropped &lt;-<span class="st"> </span><span class="kw"><a href="../reference/drop_crumbs.html">drop_crumbs</a></span>(p, <span class="dt">threshold =</span> area_thresh)
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(p, <span class="dt">col =</span> <span class="st">"black"</span>, <span class="dt">main =</span> <span class="st">"Original"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(p_dropped, <span class="dt">col =</span> <span class="st">"black"</span>, <span class="dt">main =</span> <span class="st">"After drop_crumbs()"</span>)</code></pre></div>
<p><img src="smoothr_files/figure-html/drop-crumbs-polygons-1.png" width="672"></p>
<p>And, to remove lines shorter than 25 miles:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l &lt;-<span class="st"> </span>jagged_lines<span class="op">$</span>geometry[<span class="dv">8</span>]
<span class="co"># note that any units can be used</span>
<span class="co"># conversion to units of projection happens automatically</span>
length_thresh &lt;-<span class="st"> </span>units<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/units/topics/set_units">set_units</a></span>(<span class="dv">25</span>, miles)
l_dropped &lt;-<span class="st"> </span><span class="kw"><a href="../reference/drop_crumbs.html">drop_crumbs</a></span>(l, <span class="dt">threshold =</span> length_thresh)
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(l, <span class="dt">lwd =</span> <span class="dv">5</span>, <span class="dt">main =</span> <span class="st">"Original"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(l_dropped, <span class="dt">lwd =</span> <span class="dv">5</span>, <span class="dt">main =</span> <span class="st">"After drop_crumbs()"</span>)</code></pre></div>
<p><img src="smoothr_files/figure-html/drop-crumbs-lines-1.png" width="672"></p>
</div>
<div id="fill-holes" class="section level3">
<h3 class="hasAnchor">
<a href="#fill-holes" class="anchor"></a>Fill holes</h3>
<p><code><a href="../reference/fill_holes.html">fill_holes()</a></code> fills (i.e. removes) holes in polygons when they are below a given area threshold. As with <code><a href="../reference/drop_crumbs.html">drop_crumbs()</a></code>, the threshold can either be provided as a number or a <code>units</code> object.</p>
<p>For example, to remove holes less than 800 square kilometers in size:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span>jagged_polygons<span class="op">$</span>geometry[<span class="dv">5</span>]
area_thresh &lt;-<span class="st"> </span>units<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/units/topics/set_units">set_units</a></span>(<span class="dv">800</span>, km<span class="op">^</span><span class="dv">2</span>)
p_dropped &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fill_holes.html">fill_holes</a></span>(p, <span class="dt">threshold =</span> area_thresh)
<span class="co"># plot</span>
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(p, <span class="dt">col =</span> <span class="st">"black"</span>, <span class="dt">main =</span> <span class="st">"Original"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(p_dropped, <span class="dt">col =</span> <span class="st">"black"</span>, <span class="dt">main =</span> <span class="st">"After fill_holes()"</span>)</code></pre></div>
<p><img src="smoothr_files/figure-html/fill-polygons-1.png" width="672"></p>
</div>
</div>
<div id="raster-to-polygon-conversion" class="section level2">
<h2 class="hasAnchor">
<a href="#raster-to-polygon-conversion" class="anchor"></a>Raster-to-polygon conversion</h2>
<p>The whole point of this <code>smoothr</code> business was to smooth out polygons generated from rasters, so let’s work through a quick example of that. Treating <code>jagged_raster</code> as the occurrence probability for a species, imagine we want to produce a range map for this species, showing where it occurs with at least 50% probability. We can convert the raster to a binary presence/absence map, then polygonize.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># pres/abs map</span>
r &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/cut">cut</a></span>(jagged_raster, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="fl">0.5</span>, <span class="ot">Inf</span>)) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/rasterToPolygons">rasterToPolygons</a></span>(r), <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="ot">NA</span>) <span class="co"># set up plot extent</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(r, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">"white"</span>, <span class="st">"#4DAF4A"</span>), <span class="dt">legend =</span> <span class="ot">FALSE</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">box =</span> <span class="ot">FALSE</span>)
<span class="co"># polygonize</span>
r_poly &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/rasterToPolygons">rasterToPolygons</a></span>(r, <span class="cf">function</span>(x){x <span class="op">==</span><span class="st"> </span><span class="dv">1</span>}, <span class="dt">dissolve =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_as_sf">st_as_sf</a></span>()
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(r_poly, <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="st">"grey20"</span>, <span class="dt">lwd =</span> <span class="fl">1.5</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="smoothr_files/figure-html/polygonize-1.png" width="672"></p>
<p>To start cleaning this up, let’s remove all the small polygons resulting from a single raster cell. Recall that the cells is this raster are 100 square kilometers each.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r_poly_dropped &lt;-<span class="st"> </span><span class="kw"><a href="../reference/drop_crumbs.html">drop_crumbs</a></span>(r_poly, <span class="kw"><a href="http://www.rdocumentation.org/packages/units/topics/set_units">set_units</a></span>(<span class="dv">101</span>, km<span class="op">^</span><span class="dv">2</span>))
<span class="co"># plot</span>
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/rasterToPolygons">rasterToPolygons</a></span>(r), <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="ot">NA</span>) <span class="co"># set up plot extent</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(r_poly_dropped, <span class="dt">col =</span> <span class="st">"#4DAF4A"</span>, <span class="dt">border =</span> <span class="st">"grey20"</span>, <span class="dt">lwd =</span> <span class="fl">1.5</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="smoothr_files/figure-html/raster-drop-1.png" width="672"></p>
<p>There are two holes in the large central polygon. Next, let’s fill in the smaller of the two holes, which is two raster cells (200 square kilometers) in size, but keep the larger one.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r_poly_filled &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fill_holes.html">fill_holes</a></span>(r_poly_dropped, <span class="kw"><a href="http://www.rdocumentation.org/packages/units/topics/set_units">set_units</a></span>(<span class="dv">201</span>, km<span class="op">^</span><span class="dv">2</span>))
<span class="co"># plot</span>
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/rasterToPolygons">rasterToPolygons</a></span>(r), <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="ot">NA</span>) <span class="co"># set up plot extent</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(r_poly_filled, <span class="dt">col =</span> <span class="st">"#4DAF4A"</span>, <span class="dt">border =</span> <span class="st">"grey20"</span>, <span class="dt">lwd =</span> <span class="fl">1.5</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="smoothr_files/figure-html/raster-fill-1.png" width="672"></p>
<p>Finally, to make this more aesthetically pleasing, I’ll smooth out those sharp edges.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r_poly_smooth &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smooth.html">smooth</a></span>(r_poly_filled, <span class="dt">method =</span> <span class="st">"ksmooth"</span>, <span class="dt">smoothness =</span> <span class="fl">0.5</span>)
<span class="co"># plot</span>
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/rasterToPolygons">rasterToPolygons</a></span>(r), <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="ot">NA</span>) <span class="co"># set up plot extent</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(r_poly_smooth, <span class="dt">col =</span> <span class="st">"#4DAF4A"</span>, <span class="dt">border =</span> <span class="st">"grey20"</span>, <span class="dt">lwd =</span> <span class="fl">1.5</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="smoothr_files/figure-html/smooth-raster-1.png" width="672"></p>
<p>Nice, so much easier on the eyes!</p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>Chaikin’s corner cutting algorithm:</p>
<ul>
<li>Chaikin, G. An algorithm for high speed curve generation. Computer Graphics and Image Processing 3 (1974), 346–349</li>
<li><a href="http://graphics.cs.ucdavis.edu/education/CAGDNotes/Chaikins-Algorithm.pdf" class="uri">http://graphics.cs.ucdavis.edu/education/CAGDNotes/Chaikins-Algorithm.pdf</a></li>
<li><a href="https://stackoverflow.com/a/47255374/3591386">Where to find Python implementation of Chaikin’s corner cutting algorithm?</a></li>
</ul>
<p>Kernel smoothing:</p>
<ul>
<li><a href="https://stats.stackexchange.com/a/143608/44268">Nadaraya-Watson Optimal Bandwidth</a></li>
</ul>
<p>Spline interpolation:</p>
<ul>
<li><a href="https://stackoverflow.com/questions/26087772/26089377">Create polygon from set of points distributed</a></li>
<li><a href="https://gis.stackexchange.com/questions/24827/24929">Smoothing polygons in contour map?</a></li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#setup">Setup</a></li>
      <li><a href="#example-data">Example data</a></li>
      <li><a href="#smoothing-methods">Smoothing methods</a></li>
      <li><a href="#other-goodies">Other goodies</a></li>
      <li><a href="#raster-to-polygon-conversion">Raster-to-polygon conversion</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://strimas.com">Matthew Strimas-Mackey</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
